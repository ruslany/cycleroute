generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Route {
  id             String        @id @default(cuid())
  name           String
  description    String?
  originalGpx    String
  distanceMeters Float
  elevationGainM Float?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  routePoints RoutePoint[]
  pois        POI[]
  cuePoints   CuePoint[]
  weatherData WeatherData[]
}

model RoutePoint {
  id        String @id @default(cuid())
  routeId   String
  sequence  Int
  latitude  Float
  longitude Float
  elevation Float?

  route Route @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId, sequence])
}

model POI {
  id          String  @id @default(cuid())
  routeId     String
  name        String
  description String?
  category    String
  latitude    Float
  longitude   Float
  sequence    Int?

  route Route @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId])
}

model CuePoint {
  id          String  @id @default(cuid())
  routeId     String
  sequence    Int
  latitude    Float
  longitude   Float
  instruction String
  distanceM   Float?

  route Route @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId, sequence])
}

model WeatherData {
  id          String   @id @default(cuid())
  routeId     String
  latitude    Float
  longitude   Float
  fetchedAt   DateTime @default(now())
  tempC       Float?
  windSpeedMs Float?
  windDeg     Float?
  description String?
  icon        String?

  route Route @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId])
}
