generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Route {
  id             String        @id @default(cuid())
  name           String
  description    String?
  gpxBlobUrl     String
  distanceMeters Float
  elevationGainM Float?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  pois        POI[]
  cuePoints   CuePoint[]
  weatherData WeatherData[]
}

model POI {
  id          String  @id @default(cuid())
  routeId     String
  name        String
  description String?
  category    String
  latitude    Float
  longitude   Float
  sequence    Int?

  route Route @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId])
}

model CuePoint {
  id          String  @id @default(cuid())
  routeId     String
  sequence    Int
  latitude    Float
  longitude   Float
  instruction String
  distanceM   Float?

  route Route @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId, sequence])
}

model WeatherData {
  id                   String   @id @default(cuid())
  routeId              String
  latitude             Float
  longitude            Float
  distanceFromStartM   Float
  plannedStartTime     DateTime
  estimatedArrivalTime DateTime
  tempC                Float
  feelsLikeC           Float
  precipProbability    Float
  precipMm             Float
  windSpeedKmh         Float
  windGustsKmh         Float
  windDirectionDeg     Int
  cloudCoverPercent    Float
  weatherCode          Int
  travelDirectionDeg   Float
  fetchedAt            DateTime @default(now())

  route Route @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId, plannedStartTime])
}
